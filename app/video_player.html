<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>Yayınlar</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: white;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #header {
            padding: 10px 20px;
            background: #1f1f1f;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 50px;
            box-sizing: border-box;
        }

        h2 {
            margin: 0;
            font-size: 16px;
            color: #ddd;
            font-weight: 600;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        button {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        button:hover {
            background: #444;
        }

        button.active {
            background: #2196F3;
            border-color: #2196F3;
        }

        /* Main Container */
        #main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        /* GRID MODE (Default) */
        #main-container.grid-mode #video-grid {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 10px;
            padding: 10px;
            overflow-y: auto;
            align-content: center;
        }

        #main-container.grid-mode #focus-area {
            display: none;
        }

        /* FOCUS MODE */
        #main-container.focus-mode {
            flex-direction: row;
        }

        #main-container.focus-mode #focus-area {
            flex: 1;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            position: relative;
        }

        #main-container.focus-mode #video-grid {
            width: 250px;
            background: #181818;
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            overflow-y: auto;
        }

        #main-container.focus-mode .video-wrapper {
            /* In sidebar, force smaller height */
            aspect-ratio: 16/9;
            min-height: 140px;
        }

        /* Common Video Wrapper */
        .video-wrapper {
            background: black;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: transform 0.1s, border 0.1s;
            border: 2px solid transparent;
        }

        .video-wrapper:hover {
            border-color: #555;
        }

        .video-wrapper video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .video-label {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.6);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            color: white;
            z-index: 10;
        }

        /* Empty State */
        .empty-state {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #555;
            font-size: 18px;
        }
    </style>
</head>

<body>
    <div id="header">
        <h2 id="pageTitle">Yayınlar</h2>
        <div class="controls">
            <button id="btnToggleLayout" onclick="toggleLayout()">Görünüm: Izgara</button>
        </div>
    </div>

    <!-- Layout Container -->
    <div id="main-container" class="grid-mode">
        <!-- Focus Area (Only visible in Focus Mode) -->
        <div id="focus-area">
            <div style="color:#555;">Yayın seçmek için tıklayın</div>
        </div>

        <!-- Grid / Sidebar Area -->
        <div id="video-grid">
            <div class="empty-state">Yayın bekleniyor...</div>
        </div>
    </div>

    <!-- Script to handle dynamic streams -->
    <script>
        const container = document.getElementById('main-container');
        const grid = document.getElementById('video-grid');
        const focusArea = document.getElementById('focus-area');
        const emptyState = document.querySelector('.empty-state');
        const btnToggle = document.getElementById('btnToggleLayout');

        let streams = {}; // Store active active wrapper elements
        let focusedStreamId = null;
        let isFocusMode = false;

        // --- LAYOUT LOGIC ---
        function toggleLayout() {
            isFocusMode = !isFocusMode;
            updateLayout();
        }

        function updateLayout() {
            if (isFocusMode) {
                container.className = 'focus-mode';
                btnToggle.innerText = "Görünüm: Odak";
                btnToggle.classList.add('active');

                // If nothing focused, focus the first available
                if (!focusedStreamId) {
                    const firstId = Object.keys(streams)[0];
                    if (firstId) setFocus(firstId);
                } else {
                    // Re-apply focus to move element
                    setFocus(focusedStreamId);
                }
            } else {
                container.className = 'grid-mode';
                btnToggle.innerText = "Görünüm: Izgara";
                btnToggle.classList.remove('active');

                // Move everything back to grid
                Object.values(streams).forEach(wrapper => {
                    grid.appendChild(wrapper);
                });

                // Clear focus area (except placeholder)
                focusArea.innerHTML = '<div style="color:#555;">Yayın seçmek için tıklayın</div>';
            }
        }

        function setFocus(id) {
            if (!streams[id]) return;
            focusedStreamId = id;

            if (!isFocusMode) {
                isFocusMode = true;
                updateLayout();
            }

            // Move focused element to focus area
            focusArea.innerHTML = '';
            const wrapper = streams[id];

            focusArea.appendChild(wrapper);

            // Ensure others are in grid
            Object.keys(streams).forEach(otherId => {
                if (otherId !== id) {
                    grid.appendChild(streams[otherId]);
                }
            });
        }

        // --- API ---
        window.api = {
            addStream: (id, name, stream) => {
                if (streams[id]) return; // Already exists

                // Remove empty state if present
                if (emptyState && emptyState.parentElement) {
                    emptyState.remove();
                }

                const wrapper = document.createElement('div');
                wrapper.className = 'video-wrapper';
                wrapper.id = `wrapper-${id}`;
                wrapper.onclick = () => setFocus(id);

                const video = document.createElement('video');
                video.autoplay = true;
                video.playsInline = true;
                video.srcObject = stream;

                // Single Mirror Logic: Rotate Y 180deg for local camera
                if (id === 'me-cam') {
                    video.style.transform = 'rotateY(180deg)';
                }

                // Add name label
                const label = document.createElement('div');
                label.className = 'video-label';
                label.innerText = name;

                wrapper.appendChild(video);
                wrapper.appendChild(label);

                // Append
                streams[id] = wrapper;

                // Decision: Where to put it?
                if (isFocusMode && focusedStreamId) {
                    grid.appendChild(wrapper);
                } else if (isFocusMode && !focusedStreamId) {
                    setFocus(id); // Auto focus first one
                } else {
                    grid.appendChild(wrapper);
                }
            },
            removeStream: (id) => {
                if (streams[id]) {
                    streams[id].remove();
                    delete streams[id];
                }

                if (focusedStreamId === id) {
                    focusedStreamId = null;
                    // Try to focus another one
                    const nextId = Object.keys(streams)[0];
                    if (nextId && isFocusMode) {
                        setFocus(nextId);
                    } else if (!nextId) {
                        // No streams left
                        if (grid.children.length === 0 && focusArea.children.length <= 1) {
                            container.className = 'grid-mode'; // Reset to grid
                            isFocusMode = false;
                            grid.appendChild(emptyState);
                        }
                    }
                }

                if (Object.keys(streams).length === 0) {
                    grid.appendChild(emptyState);
                }
            },
            setTitle: (text) => {
                document.getElementById('pageTitle').innerText = text;
            }
        };
    </script>
</body>

</html>